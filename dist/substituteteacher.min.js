"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(a){if(!a||"string"!=typeof a)throw"rawSentence must be a string.";for(var b=[],c=0,e=0;e<a.length;e++){var f=a.charAt(e);f.match(/[\.,"\/!\?\*\+;:{}=()\[\]\s]/g)&&(e>c&&b.push(a.slice(c,e)+(f.match(/\s/g)?d:"")),f.match(/\s/g)||b.push(f+(e+1<a.length&&a[e+1].match(/\s/g)?d:"")),c=e+1)}return c<e&&b.push(a.slice(c,e)),b}function c(){var a=document.createElement("fakeelement");for(var b in e)if(void 0!==a.style[b])return e[b]}var d="&nbsp;",e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"},f=function(a,b){return a.action.cost-b.action.cost},g=function(a){for(var b=a.slice(),c=b.length;c;c--){var d=Math.floor(Math.random()*c),e=[b[d],b[c-1]];b[c-1]=e[0],b[d]=e[1]}return b},h=function(a,b){return'<div class="'+a+"-to-idx-"+b+" "+a+'-word">\n        <span class="'+a+'-visible" style="opacity: 0"></span>\n        <span class="'+a+'-invisible" style="width: 0px"></span>\n      </div>'},i=function(a,b,c,d){var e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style"),g="@font-face {\n        font-family: "+a+"-empty;\n        src: url(data:application/font-woff;charset=utf-8;base64,d09GRk9UVE8AAAQ0AAoAAAAAA+wAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAAA9AAAAJ4AAACeXQ48j09TLzIAAAGUAAAAYAAAAGAIIgbWY21hcAAAAfQAAABEAAAARAAyAGlnYXNwAAACOAAAAAgAAAAIAAAAEGhlYWQAAAJAAAAANgAAADb9mzB5aGhlYQAAAngAAAAkAAAAJAHiAeVobXR4AAACnAAAABAAAAAQAAAAAG1heHAAAAKsAAAABgAAAAYABFAAbmFtZQAAArQAAAFdAAABXVqZXRlwb3N0AAAEFAAAACAAAAAgAAMAAAEABAQAAQEBDHNwYWNlLWVtcHR5AAECAAEAOvgcAvgbA/gYBB4KABlT/4uLHgoAGVP/i4sMB4tr+JT4dAUdAAAAfA8dAAAAgREdAAAACR0AAACVEgAFAQEMFxkbHnNwYWNlLWVtcHR5c3BhY2UtZW1wdHl1MHUxdTIwAAACAYkAAgAEAQEEBwoN/JQO/JQO/JQO/JQO+JQU+JQViwwKAAAAAwIAAZAABQAAAUwBZgAAAEcBTAFmAAAA9QAZAIQAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAABAAAAAIAHg/+D/4AHgACAAAAABAAAAAAAAAAAAAAAgAAAAAAACAAAAAwAAABQAAwABAAAAFAAEADAAAAAIAAgAAgAAAAEAIP/9//8AAAAAACD//f//AAH/4wADAAEAAAAAAAAAAAABAAH//wAPAAEAAAABAAAAeR2GXw889QALAgAAAAAAzz54vgAAAADPPni+AAAAAAAAAAAAAAAIAAIAAAAAAAAAAQAAAeD/4AAAAgAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAABQAAAEAAAAAAAOAK4AAQAAAAAAAQAWAAAAAQAAAAAAAgAOAGMAAQAAAAAAAwAWACwAAQAAAAAABAAWAHEAAQAAAAAABQAWABYAAQAAAAAABgALAEIAAQAAAAAACgAoAIcAAwABBAkAAQAWAAAAAwABBAkAAgAOAGMAAwABBAkAAwAWACwAAwABBAkABAAWAHEAAwABBAkABQAWABYAAwABBAkABgAWAE0AAwABBAkACgAoAIcAcwBwAGEAYwBlAC0AZQBtAHAAdAB5AFYAZQByAHMAaQBvAG4AIAAxAC4AMABzAHAAYQBjAGUALQBlAG0AcAB0AHlzcGFjZS1lbXB0eQBzAHAAYQBjAGUALQBlAG0AcAB0AHkAUgBlAGcAdQBsAGEAcgBzAHAAYQBjAGUALQBlAG0AcAB0AHkARwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=) format('woff');\n      }\n      ."+a+"-invisible { visibility: hidden; }\n      ."+a+"-animating {\n        -webkit-transition: "+b+"s all linear;\n        -moz-transition: "+b+"s all linear;\n        -o-transition: "+b+"s all linear;\n        transition: "+b+"s all linear;\n      }\n      ."+a+" {\n        position: relative;\n        font-family: "+a+"-empty;\n        margin:\n      }\n      ."+a+":after {\n        content: ' ';\n        display: block;\n        clear: both;\n      }\n      ."+a+"-text-width-calculation {\n        position: absolute;\n        visibility: hidden;\n        font-family: "+d+";\n        height: auto;\n        width: auto;\n        display: inline-block;\n        white-space: nowrap;\n      }\n      ."+a+" ."+a+"-old-content {\n        font-family: "+d+";\n        position: absolute;\n        left: 0;\n        width: 100%;\n        top: 0;\n        height: 100%;\n      }\n      ."+a+"."+a+"-loaded ."+a+"-old-content {\n        display: none;\n      }\n      ."+a+"."+a+"-loaded ."+a+"-word {\n        opacity: 1;\n      }\n      ."+a+" ."+a+"-punctuation { margin-left: -0.3rem; }\n      ."+a+" ."+a+"-word {\n        display: inline-block;\n        position: relative;\n        float: left;\n        opacity: 0;\n        font-family: "+d+";\n        text-align: center;\n        height: "+c+";\n        white-space: nowrap;\n        overflow: hidden;\n      }\n      ."+a+" ."+a+"-word span {\n        top: 0;\n        position: relative;\n        overflow: hidden;\n        height: 1px;\n        display: inline-block;\n      }\n      ."+a+" ."+a+"-word ."+a+"-visible {\n        position: absolute;\n        display: inline-block;\n        height: "+c+";\n        top: 0;\n        bottom: 0;\n        right:0;\n        left: 0;\n    }";f.type="text/css",f.styleSheet?f.styleSheet.cssText=g:f.appendChild(document.createTextNode(g)),e.appendChild(f)},j=function(){function b(a,d,e){var f=this;_classCallCheck(this,b),this.sub=d,this.ctx=e,this.transitionEnd=c(),this.animatingClass=d.settings.namespace+"-animating",this.steps=function(){return"remove"===a?[function(){f._fadeOut()},function(){f._setWidth()},function(){f._removeElement()}]:"sub"===a?[function(){f._reIndex()},function(){f._fadeOut()},function(){f._setWidth()},function(){f._setTextAndFadeIn()},function(){f._cleanUp()}]:"insert"===a?[function(){f._setWidth()},function(){f._setTextAndFadeIn()},function(){f._cleanUp()}]:"keep"===a?[function(){f._reIndex()}]:void console.error("Unknown animation: ",a)}(),this.steps[0]()}return _createClass(b,[{key:"_reIndex",value:function(){var a=this.ctx,b=a.word,c=a.fromIndexClass,d=a.toIndexClass,e=this.steps;this.sub.settings.verbose&&console.log("_reIndex ",b.innerText," from ",c," to ",d),b.classList.remove(c),b.classList.add(d),e.shift(),e.length>0&&e[0]()}},{key:"_fadeOut",value:function(){var a=this.ctx,b=a.visible,c=a.invisible,d=this.steps,e=this.sub,f=this.animatingClass,g=this.transitionEnd;e.settings.verbose&&console.log("_fadeOut"),b.classList.add(f),d.shift(),b.addEventListener(g,d[0],!1),c.style.width=c.offsetWidth+"px",b.style.opacity=0}},{key:"_setWidth",value:function(){var a=this.ctx,b=a.visible,c=a.invisible,d=a.newText,e=this.steps,f=this.sub,g=this.animatingClass,h=this.transitionEnd;f.settings.verbose&&console.log("_setWidth"),b.classList.remove(g),c.classList.add(g),b.removeEventListener(h,e[0],!1),e.shift(),c.addEventListener(h,e[0],!1);var i=this._calculateWordWidth(d,f.wrapper.tagName,f.wrapper.className.split(" "));setTimeout(function(){c.style.width=i+"px"},5)}},{key:"_removeElement",value:function(){var a=this.ctx,b=a.invisible,c=a.word,d=this.steps,e=this.sub,f=this.transitionEnd;e.settings.verbose&&console.log("_removeElement"),b.removeEventListener(f,d[0],!1),e.wrapper.removeChild(c)}},{key:"_setTextAndFadeIn",value:function(){var a=this.ctx,b=a.visible,c=a.invisible,d=a.newText,e=this.steps,f=this.sub,g=this.animatingClass,h=this.transitionEnd;f.settings.verbose&&console.log("_setTextAndFadeIn"),c.classList.remove(g),b.classList.add(g),c.removeEventListener(h,e[0],!1),e.shift(),b.addEventListener(h,e[0],!1),b.innerHTML=d,c.innerHTML=d,b.style.opacity=1}},{key:"_cleanUp",value:function(){var a=this.ctx,b=a.visible,c=a.invisible,d=this.steps,e=this.sub,f=this.animatingClass,g=this.transitionEnd;e.settings.verbose&&console.log("_cleanUp"),c.classList.remove(f),b.classList.remove(f),b.removeEventListener(g,d[0],!1),c.style.width="auto"}},{key:"_calculateWordWidth",value:function(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],e=document.createElement(c);d.push(this.sub.settings.namespace+"-text-width-calculation"),e.setAttribute("class",d.join(" ")),e.innerHTML=b,document.body.appendChild(e);var f=parseFloat(a.getComputedStyle(e,null).width);return e.parentNode.removeChild(e),f}}]),b}(),k=function(){function c(b){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,c);var e={containerId:d.containerId||"sub",namespace:d.namespace||"sub",interval:d.interval||5e3,speed:d.speed||200,mobileWidth:d.mobileWidth||null,verbose:void 0!==d.verbose&&d.verbose,random:void 0!==d.random&&d.random,best:void 0===d.best||d.best,clearOriginalContent:void 0===d.clearOriginalContent||d.clearOriginalContent,_testing:void 0!==d._testing&&d._testing};this.wrapper=document.getElementById(e.containerId),this.settings=e;var f=e.namespace,g=a.getComputedStyle(this.wrapper);i(f,e.speed/1e3,g.height,g.fontFamily),this.highestTimeoutId=0,this.currentState=null,this.actions=[],this.invisibleClass=" ."+f+"-invisible",this.visibleClass=" ."+f+"-visible",this.fromClass=f+"-from-idx-",this.toClass=f+"-to-idx-",this.wrapperSelector="#"+f,this.isEmpty=!0,this._setupContainer(),e._testing||this._setSentences(this._parseSentences(b))}return _createClass(c,[{key:"_parseSentences",value:function(a){if(!a||"object"!==(void 0===a?"undefined":_typeof(a)))throw"rawSentences must be an array of strings.";return a.map(b)}},{key:"_setupContainer",value:function(){var b=this.settings,c=b.containerId,e=b.clearOriginalContent,f=b.namespace,g=document.getElementById(c);if(!g)throw"Cannot find element with id:"+c;var h=a.getComputedStyle(g);g.style.height=h.height,e?g.innerHTML="":(g.style.width=h.width,g.innerHTML='<span class="'+f+'-old-content">'+g.innerHTML.replace(" ",d)+"</span>"),g.className=f}},{key:"_getOnResize",value:function(){var b=this;return this.isStopped=!1,function(){b.lastWindowWidth=a.innerWidth,null!==b.settings.mobileWidth&&(!b.isStopped&&b.lastWindowWidth<b.settings.mobileWidth?(b._stop(),b.isStopped=!0):b.isStopped&&b.lastWindowWidth>b.settings.mobileWidth&&(b._run(),b.isStopped=!1))}}},{key:"_run",value:function(){var a=this,b=this.actions,c=this.wrapper,d=this.settings,e=d.namespace,f=d.interval;if(!this.actions)return void setTimeout(function(){this.run()},20);if(this.isEmpty){this.isEmpty=!1;var g=this._computeActionsToChange([],b[0].from);if(!g)throw console.log(g),"returned null action";this._applyAction(g)}this.highestTimeoutId=setTimeout(function(){c.classList.add(e+"-loaded"),c.style.height="",a._sentenceLoop()},f)}},{key:"run",value:function(){return this.onResize=this._getOnResize(),a.addEventListener("resize",this.onResize,!1),a.addEventListener("orientationchange",this.onResize,!1),this._run(),this}},{key:"_stop",value:function(){var a=this;clearTimeout(a.highestTimeoutId)}},{key:"stop",value:function(){return a.removeEventListener("resize",this.onResize,!1),a.removeEventListener("orientationchange",this.onResize,!1),this._stop(),this}},{key:"_computeActionsToChange",value:function(a,b){this.settings.verbose&&console.log("_computeActionsToChange: ",a,b);var c={from:a,to:b,sub:[],remove:[],insert:[],keep:[],cost:0},d=function d(e,f){var g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e>=a.length)return g||(c.insert=c.insert.concat(b.slice(f).map(function(a,b){return{toWord:a,toIndex:b+f}}))),b.length-f;if(f>=b.length)return g||(c.remove=c.remove.concat(a.slice(e).map(function(a,b){return{fromWord:a,fromIndex:b+e}}))),a.length-f;if(a[e]===b[f])return g?0:(c.keep.push({fromWord:a[e],toWord:b[f],fromIndex:e,toIndex:f}),d(e+1,f+1));var h=a.indexOf(b[f],e);if(g)return h;if(e+1==a.length&&-1===h)return c.sub.push({fromWord:a[e],toWord:b[f],fromIndex:e,toIndex:f}),d(e+1,f+1)+1;var i=d(e,f+1,!0);if(-1===h)return 0===i?(c.insert.push({toWord:b[f],toIndex:f}),d(e,f+1)+1):(c.sub.push({fromWord:a[e],toWord:b[f],fromIndex:e,toIndex:f}),d(e+1,f+1)+1);if(h===e+1&&i===e||h===i){return a.length-e>b.length-f?(c.insert.push({toWord:b[f],toIndex:f}),d(e+1,f)+1):(c.remove.push({fromWord:a[e],fromIndex:e}),d(e,f+1)+1)}return h>i&&-1!==i?(c.sub.push({fromWord:a[e],toWord:b[f],fromIndex:e,toIndex:f}),d(e+1,f+1)+1):(c.remove=c.remove.concat(a.slice(e,h).map(function(a,b){return{fromWord:a,fromIndex:b+e}})),c.keep.push({fromWord:a[h],toWord:b[f],fromIndex:h,toIndex:f}),d(h+1,f+1)+(h-e))};return c.cost=d(0,0),c}},{key:"_setSentences",value:function(a){var b=this,c=a.length;if(0===a.length&&(this.actions=[]),this.settings.best){var d=a.map(function(c,d){return a.map(function(c,e){return d===e?{action:{cost:Number.MAX_VALUE},fromIndex:d,toIndex:e}:{action:b._computeActionsToChange(a[d],a[e]),fromIndex:d,toIndex:e}})});d.sort(function(a,b){return a.sort(f),b.sort(f),a[0].cost-b[0].cost});var e=0,h=0,i=[],j=d[0][0].fromIndex;for(h=0;h<c;h++)for(var k=0;k<c;k++)if(h===c-1&&d[e][k].toIndex===j||h!==c-1&&-1===i.indexOf(d[e][k].toIndex)){this.actions.push(d[e][k].action),i.push(e),e=d[e][k].toIndex;break}if(this.settings.random){var l=Math.floor(Math.random()*c);for(h=0;h<l;h++)this.actions.push(this.actions.shift())}}else{var m=this.settings.random?g(a):a;this.actions=this.actions.concat(m.map(function(a,d){var e=0===d?c-1:d-1;return b._computeActionsToChange(m[e],a)}))}}},{key:"_sentenceLoop",value:function(){var a=this,b=this.actions,c=this.settings.interval,d=this.actions.shift();if(!d)throw console.log(d,b),"returned null action";this._applyAction(d),b.push(d),clearTimeout(this.highestTimeoutId),this.highestTimeoutId=setTimeout(function(){a._sentenceLoop()},c)}},{key:"_removeAction",value:function(a){var b=this.fromClass,c=this.wrapperSelector,d=this.visibleClass,e=this.invisibleClass,f=this.settings.verbose,g=b+a.fromIndex,h={fromIndexClass:g,word:document.querySelector(c+" ."+g),visible:document.querySelector(c+" ."+g+d),invisible:document.querySelector(c+" ."+g+e),newText:""};f&&console.log("remove",h),new j("remove",this,h)}},{key:"_performInsertions",value:function(a){var b=this,c=this.toClass,d=this.wrapper,e=this.wrapperSelector,f=this.visibleClass,g=this.invisibleClass,i=this.settings,k=i.namespace,l=i.speed,m=i.verbose;setTimeout(function(){a.forEach(function(a){var i=h(k,a.toIndex);if(0===a.toIndex)d.insertAdjacentHTML("afterbegin",i);else{var l=e+" ."+c+(a.toIndex-1);document.querySelector(l).insertAdjacentHTML("afterend",i)}var n=c+a.toIndex,o={toIndexClass:n,word:document.querySelector(e+" ."+n),visible:document.querySelector(e+" ."+n+f),invisible:document.querySelector(e+" ."+n+g),newText:a.toWord};m&&console.log("insert",o),new j("insert",b,o)})},l)}},{key:"_subAction",value:function(a){var b=this.fromClass,c=this.toClass,d=this.wrapperSelector,e=this.visibleClass,f=this.invisibleClass,g=this.settings.verbose,h=b+a.fromIndex,i={fromIndexClass:h,toIndexClass:c+a.toIndex,word:document.querySelector(d+" ."+h),visible:document.querySelector(d+" ."+h+e),invisible:document.querySelector(d+" ."+h+f),newText:a.toWord};g&&console.log("sub",i),new j("sub",this,i)}},{key:"_keepAction",value:function(a){var b=this.fromClass,c=this.toClass,d=this.wrapperSelector,e=this.settings.verbose,f=b+a.fromIndex,g={fromIndexClass:f,toIndexClass:c+a.toIndex,word:document.querySelector(d+" ."+f)};e&&console.log("keep",g),new j("keep",this,g)}},{key:"_applyAction",value:function(a){var b=this,c=this.fromClass,d=this.toClass,e=this.settings,f=e.namespace,g=e.verbose,h=document.getElementsByClassName(f+"-word");Array.from(h).forEach(function(a){g&&console.log("replacing to- with from- for:",a),a.className=a.className.replace(d,c)}),a.sub.map(function(a){b._subAction(a)}),a.remove.map(function(a){b._removeAction(a)}),a.keep.map(function(a){b._keepAction(a)}),this._performInsertions(a.insert)}}]),c}();a.Sub=k}(window);